<div class="chat-widget-container">
  @if (isOpen) {
    <div class="chat-window">
      <div class="chat-header">
        <h3>Chat vá»›i Atheng Audio</h3>
        <button class="close-btn" (click)="toggleChat()">Ã—</button>
      </div>
      
      <div class="chat-body">
        @if (authService.isLoggedIn) {
          <div class="messages-list">
            <div class="welcome-message">
              <p>ChÃ o báº¡n! ChÃºng tÃ´i cÃ³ thá»ƒ giÃºp gÃ¬ cho báº¡n?</p>
            </div>

            @for (msg of messages$ | async; track msg.id) {
              <div class="message" [class.sent]="msg.from === authService.currentUserValue?.id" [class.received]="msg.from !== authService.currentUserValue?.id">
                
                @if (msg.from !== authService.currentUserValue?.id) {
                  <span class="msg-sender">{{ msg.fromName }}</span>
                }
                
                <span class="msg-content">{{ msg.content }}</span>
              </div>
            }
          </div>
        } @else {
          <div class="chat-login-prompt">
            Vui lÃ²ng <a routerLink="/login" (click)="toggleChat()">Ä‘Äƒng nháº­p</a> Ä‘á»ƒ báº¯t Ä‘áº§u chat.
          </div>
        }
      </div>

      <div class="chat-footer">
        <input 
          type="text" 
          placeholder="Nháº­p tin nháº¯n..." 
          [(ngModel)]="newMessage"
          (keyup.enter)="onSendMessage()"
          [disabled]="!authService.isLoggedIn"
        />
        <button class="send-btn" (click)="onSendMessage()" [disabled]="!authService.isLoggedIn">
          âž¤
        </button>
      </div>
    </div>
  }

  <button class="chat-toggle-btn" (click)="toggleChat()">
    {{ isOpen ? 'âœ•' : 'ðŸ’¬' }}
  </button>
</div>