<div class="product-detail-page">
  <div class="container">
    <div class="breadcrumb">
      <a routerLink="/">Trang ch·ªß</a>
      <span class="separator">/</span>
      <a routerLink="/products">S·∫£n ph·∫©m</a>
      <span class="separator">/</span>
      <span class="current" *ngIf="product">{{ product.name }}</span>
    </div>

    @if (isLoading) {
      <div class="loading-state">
        <div class="loading-spinner"></div>
        <p>ƒêang t·∫£i th√¥ng tin s·∫£n ph·∫©m...</p>
      </div>
    } @else if (product) {
      <div class="product-detail">
        <div class="product-main">
          <div class="product-images">
            <div class="main-image">
              <img [src]="selectedImage" [alt]="product.name" class="product-image">
              <div class="image-badges">
                @if (product.originalPrice && product.originalPrice > product.price) {
                  <div class="discount-badge">
                    -{{ getDiscount() }}%
                  </div>
                }
                @if (product.stock <= 0) {
                  <div class="out-of-stock-badge">
                    H·∫øt H√†ng
                  </div>
                }
                @if (product.stock > 0 && product.stock < 10) {
                  <div class="low-stock-badge">
                    S·∫Øp h·∫øt h√†ng
                  </div>
                }
              </div>
            </div>
            
            <div class="image-thumbnails" *ngIf="product.images && product.images.length > 1">
              @for (image of product.images; track image) {
                <div 
                  class="thumbnail" 
                  [class.active]="selectedImage === image"
                  (click)="changeImage(image)"
                >
                  <img [src]="image" [alt]="product.name">
                </div>
              }
            </div>
          </div>

          <div class="product-info">
            <div class="product-header">
              <h1 class="product-title">{{ product.name }}</h1>
              <div class="product-meta">
                <span class="product-brand">Th∆∞∆°ng hi·ªáu: {{ product.brand }}</span>
                <!-- <span class="product-sku">M√£ SP: #{{ product.id }}</span> -->
                <span class="product-stock" [class.in-stock]="product.stock > 0" [class.out-of-stock]="product.stock <= 0">
                  {{ product.stock > 0 ? 'C√≤n h√†ng' : 'H·∫øt h√†ng' }}
                </span>
              </div>
            </div>

            <div class="product-rating">
              <div class="rating-stars">
                <span class="stars">{{ getStarRating(product.rating || 0) }}</span>
                <span class="rating-value">{{ (product.rating || 0) | number:'1.1-1' }}/5</span>
              </div>
              <span class="reviews-count">({{ product.reviewCount }} ƒë√°nh gi√°)</span>
              <a (click)="setActiveTab('reviews')" class="write-review">Vi·∫øt ƒë√°nh gi√°</a>
            </div>

            <div class="product-price">
              <span class="current-price">{{ product.price | number }}‚Ç´</span>
              @if (product.originalPrice && product.originalPrice > product.price) {
                <span class="original-price">
                  {{ product.originalPrice | number }}‚Ç´
                </span>
                <span class="discount-amount">
                  Ti·∫øt ki·ªám: {{ (product.originalPrice - product.price) | number }}‚Ç´
                </span>
              }
            </div>

            <div class="product-short-desc">
              <p>{{ product.description }}</p>
            </div>

            <div class="product-features" *ngIf="product.features && product.features.length > 0">
              <h3>ƒê·∫∑c ƒëi·ªÉm n·ªïi b·∫≠t:</h3>
              <ul class="features-list">
                @for (feature of product.features; track feature) {
                  <li class="feature-item">
                    <span class="feature-icon">‚úì</span>
                    {{ feature }}
                  </li>
                }
              </ul>
            </div>

            <div class="product-actions">
              <div class="quantity-selector">
                <label class="quantity-label">S·ªë l∆∞·ª£ng:</label>
                <div class="quantity-controls">
                  <button 
                    class="quantity-btn" 
                    (click)="decreaseQuantity()"
                    [disabled]="quantity <= 1"
                  >
                    ‚àí
                  </button>
                  <span class="quantity-display">{{ quantity }}</span>
                  <button 
                    class="quantity-btn" 
                    (click)="increaseQuantity()"
                    [disabled]="quantity >= product.stock"
                  >
                    +
                  </button>
                </div>
                @if (product.stock > 0) {
                  <span class="stock-info">
                    {{ product.stock }} s·∫£n ph·∫©m c√≥ s·∫µn
                  </span>
                }
              </div>

              <div class="action-buttons">
                <button 
                  class="btn btn-secondary add-to-cart-btn"
                  (click)="addToCart()"
                  [disabled]="product.stock <= 0"
                >
                  <span class="btn-icon">üõí</span>
                  Th√™m V√†o Gi·ªè
                </button>
                <button 
                  class="btn btn-primary buy-now-btn"
                  (click)="buyNow()"
                  [disabled]="product.stock <= 0"
                >
                  <span class="btn-icon">‚ö°</span>
                  Mua Ngay
                </button>
                <button 
                  class="btn btn-wishlist"
                  (click)="addToWishlist()"
                  [class.in-wishlist]="isInWishlist()"
                  title="Th√™m v√†o y√™u th√≠ch"
                >
                  <span class="btn-icon">{{ isInWishlist() ? '‚ù§Ô∏è' : 'ü§ç' }}</span>
                </button>
              </div>
            </div>

            <div class="product-meta-info">
              <div class="meta-item">
                <span class="meta-icon">üöö</span>
                <div class="meta-text">
                  <strong>Giao h√†ng mi·ªÖn ph√≠</strong>
                  <span>Cho ƒë∆°n h√†ng t·ª´ 500K</span>
                </div>
              </div>
              <div class="meta-item">
                <span class="meta-icon">üîí</span>
                <div class="meta-text">
                  <strong>B·∫£o h√†nh {{ product.warranty || '2 nƒÉm' }}</strong>
                  <span>Ch√≠nh h√£ng to√†n qu·ªëc</span>
                </div>
              </div>
              <div class="meta-item">
                <span class="meta-icon">üîÑ</span>
                <div class="meta-text">
                  <strong>ƒê·ªïi tr·∫£ 30 ng√†y</strong>
                  <span>Ho√†n ti·ªÅn 100%</span>
                </div>
              </div>
              <div class="meta-item">
                <span class="meta-icon">üìû</span>
                <div class="meta-text">
                  <strong>H·ªó tr·ª£ 24/7</strong>
                  <span>1900 1234</span>
                </div>
              </div>
            </div>

            @if (showAdminNotice()) {
              <div class="admin-notice">
                <div class="admin-icon">üëë</div>
                <div class="admin-text">
                  <strong>Ch·∫ø ƒë·ªô Qu·∫£n tr·ªã vi√™n</strong>
                  <span>B·∫°n c√≥ th·ªÉ ch·ªânh s·ª≠a th√¥ng tin s·∫£n ph·∫©m</span>
                </div>
              </div>
            }
          </div>
        </div>

        <div class="product-tabs">
          <div class="tab-headers">
            <button 
              class="tab-header" 
              [class.active]="activeTab === 'description'"
              (click)="setActiveTab('description')"
            >
              üìñ M√¥ T·∫£ S·∫£n Ph·∫©m
            </button>
            <button 
              class="tab-header" 
              [class.active]="activeTab === 'specs'"
              (click)="setActiveTab('specs')"
            >
              ‚öôÔ∏è Th√¥ng S·ªë K·ªπ Thu·∫≠t
            </button>
            <button 
              class="tab-header" 
              [class.active]="activeTab === 'reviews'"
              (click)="setActiveTab('reviews')"
            >
              ‚≠ê ƒê√°nh Gi√° ({{ product.reviewCount }})
            </button>
            <button 
              class="tab-header" 
              [class.active]="activeTab === 'warranty'"
              (click)="setActiveTab('warranty')"
            >
              üõ°Ô∏è B·∫£o H√†nh &amp; ƒê·ªïi Tr·∫£
            </button>
          </div>

          <div class="tab-content">
            @if (activeTab === 'description') {
              <div class="tab-pane">
                <div class="description-content">
                  <h3>Chi Ti·∫øt S·∫£n Ph·∫©m</h3>
                  <p [innerHTML]="product.description"></p> @if (product.features && product.features.length > 0) {
                    <div class="detailed-features">
                      <h4>üìã T√≠nh nƒÉng chi ti·∫øt:</h4>
                      <ul>
                        @for (feature of product.features; track feature) {
                          <li>{{ feature }}</li>
                        }
                      </ul>
                    </div>
                  }
                  <!--Th√™m sau-->
                  <div class="product-benefits">
                    <h4>üéØ L·ª£i √≠ch khi s·ª≠ d·ª•ng:</h4>
                    <div class="benefits-grid">
                      <div class="benefit-item">
                        <span class="benefit-icon">üéµ</span>
                        <div class="benefit-text">
                          <strong>√Çm thanh s·ªëng ƒë·ªông</strong>
                          <p>Ch·∫•t l∆∞·ª£ng √¢m thanh cao c·∫•p, tr·∫£i nghi·ªám √¢m nh·∫°c ch√¢n th·ª±c</p>
                        </div>
                      </div>
                      <div class="benefit-item">
                        <span class="benefit-icon">üîã</span>
                        <div class="benefit-text">
                          <strong>Pin l√¢u d√†i</strong>
                          <p>Th·ªùi l∆∞·ª£ng pin ·∫•n t∆∞·ª£ng, s·ª≠ d·ª•ng c·∫£ ng√†y d√†i</p>
                        </div>
                      </div>
                      <div class="benefit-item">
                        <span class="benefit-icon">üéß</span>
                        <div class="benefit-text">
                          <strong>Tho·∫£i m√°i khi ƒëeo</strong>
                          <p>Thi·∫øt k·∫ø ergonomic, ƒëeo l√¢u kh√¥ng g√¢y m·ªèi</p>
                        </div>
                      </div>
                      <div class="benefit-item">
                        <span class="benefit-icon">üì±</span>
                        <div class="benefit-text">
                          <strong>K·∫øt n·ªëi ƒëa d·∫°ng</strong>
                          <p>T∆∞∆°ng th√≠ch v·ªõi nhi·ªÅu thi·∫øt b·ªã v√† h·ªá ƒëi·ªÅu h√†nh</p>
                        </div>
                      </div>
                    </div>
                  </div>
                  <!---->
                </div>
              </div>
            }

            @if (activeTab === 'specs') {
              <div class="tab-pane">
                <h3>üìä Th√¥ng S·ªë K·ªπ Thu·∫≠t</h3>
                <div class="specs-table">
                  @if (product.brand) {
                    <div class="spec-row">
                      <span class="spec-label">Th∆∞∆°ng hi·ªáu</span>
                      <span class="spec-value">{{ product.brand }}</span>
                    </div>
                  }
                  @if (product.category) {
                    <div class="spec-row">
                      <span class="spec-label">Danh m·ª•c</span>
                      <span class="spec-value">{{ product.category }}</span>
                    </div>
                  }
                  @if (product.type) {
                    <div class="spec-row">
                      <span class="spec-label">Lo·∫°i s·∫£n ph·∫©m</span>
                      <span class="spec-value">{{ product.type }}</span>
                    </div>
                  }
                  @if (product.weight) {
                    <div class="spec-row">
                      <span class="spec-label">Tr·ªçng l∆∞·ª£ng</span>
                      <span class="spec-value">{{ product.weight }}</span>
                    </div>
                  }
                  @if (product.batteryLife) {
                    <div class="spec-row">
                      <span class="spec-label">Th·ªùi l∆∞·ª£ng pin</span>
                      <span class="spec-value">{{ product.batteryLife }}</span>
                    </div>
                  }
                  @if (product.connectivity) {
                    <div class="spec-row">
                      <span class="spec-label">K·∫øt n·ªëi</span>
                      <span class="spec-value">{{ product.connectivity }}</span>
                    </div>
                  }
                  @if (product.warranty) {
                    <div class="spec-row">
                      <span class="spec-label">B·∫£o h√†nh</span>
                      <span class="spec-value">{{ product.warranty }}</span>
                    </div>
                  }
                  @if (hasSpec(product.noiseCancellation)) {
                    <div class="spec-row">
                      <span class="spec-label">Ch·ªëng ·ªìn</span>
                      <span class="spec-value">{{ product.noiseCancellation ? 'C√≥' : 'Kh√¥ng' }}</span>
                    </div>
                  }
                  @if (hasSpec(product.waterResistant)) {
                    <div class="spec-row">
                      <span class="spec-label">Ch·ªëng n∆∞·ªõc</span>
                      <span class="spec-value">{{ product.waterResistant ? 'C√≥' : 'Kh√¥ng' }}</span>
                    </div>
                  }
                </div>
              </div>
            }

            @if (activeTab === 'reviews') {
  <div class="tab-pane">
    <div class="reviews-content">

      @if (!authService.isLoggedIn) {
        <div class="review-login-prompt">
          <h3>G·ª≠i ƒë√°nh gi√° c·ªßa b·∫°n</h3>
          <p>Vui l√≤ng <a routerLink="/login">ƒëƒÉng nh·∫≠p</a> ƒë·ªÉ g·ª≠i ƒë√°nh gi√° v√† chia s·∫ª tr·∫£i nghi·ªám c·ªßa b·∫°n!</p>
        </div>
      } @else {
        <div class="review-form-container">
          <h3>G·ª≠i ƒë√°nh gi√° c·ªßa b·∫°n</h3>
          <form #reviewForm="ngForm" (ngSubmit)="onSubmitReview(reviewForm)" class="review-form">
            
            <div class="form-group">
              <label class="form-label">B·∫°n ƒë√°nh gi√° bao nhi√™u sao? *</label>
              
              <div class="star-rating-input">
                <input type="radio" id="star5" [(ngModel)]="newReview.rating" name="rating" [value]="5" required>
                <label for="star5" title="5 sao">‚òÖ</label>
                <input type="radio" id="star4" [(ngModel)]="newReview.rating" name="rating" [value]="4" required>
                <label for="star4" title="4 sao">‚òÖ</label>
                <input type="radio" id="star3" [(ngModel)]="newReview.rating" name="rating" [value]="3" required>
                <label for="star3" title="3 sao">‚òÖ</label>
                <input type="radio" id="star2" [(ngModel)]="newReview.rating" name="rating" [value]="2" required>
                <label for="star2" title="2 sao">‚òÖ</label>
                <input type="radio" id="star1" [(ngModel)]="newReview.rating" name="rating" [value]="1" required>
                <label for="star1" title="1 sao">‚òÖ</label>
              </div>
            </div>
            
            

            <div class="form-group">
              <label class="form-label" for="reviewComment">B√¨nh lu·∫≠n c·ªßa b·∫°n *</label>
              <textarea id="reviewComment" [(ngModel)]="newReview.comment" name="comment" class="form-input" rows="4" placeholder="S·∫£n ph·∫©m n√†y tuy·ªát v·ªùi..." required></textarea>
            </div>

            <button type="submit" class="btn btn-primary" [disabled]="reviewForm.invalid || isSubmittingReview">
              {{ isSubmittingReview ? 'ƒêang g·ª≠i...' : 'G·ª≠i ƒê√°nh Gi√°' }}
            </button>
          </form>
        </div>
      }
      <div class="reviews-list-container">
        <h3>T·∫•t c·∫£ ƒë√°nh gi√° ({{ product.reviewCount }})</h3>
        
        @if (!product.reviews || product.reviews.length === 0) {
          <div class="review-item-placeholder">
            <p>Ch∆∞a c√≥ ƒë√°nh gi√° n√†o cho s·∫£n ph·∫©m n√†y.</p>
          </div>
        } @else {
          <div class="reviews-list">
            @for (review of product.reviews; track $index) {
              <div class="review-item">
                <div class="review-header">
                  <div class="reviewer-info">
                    <span class="reviewer-name">{{ review.author }}</span>
                  </div>
                  <div class="review-rating">{{ '‚òÖ'.repeat(review.rating) }}{{ '‚òÜ'.repeat(5 - review.rating) }}</div>
                </div>
                <p class="review-content">{{ review.comment }}</p>
                <div class="review-footer">
                  <span class="review-date">{{ review.createdAt | date:'dd/MM/yyyy' }}</span>
                </div>
              </div>
            }
          </div>
        }
      </div>

    </div>
  </div>
}
            @if (activeTab === 'warranty') {
              <div class="tab-pane">
                </div>
            }
          </div>
        </div>

        @if (relatedProducts.length > 0) {
          <div class="related-products">
            <h2 class="section-title">S·∫£n Ph·∫©m Li√™n Quan</h2>
            <div class="related-products-grid">
              @for (relatedProduct of relatedProducts; track relatedProduct.id) {
                <app-product-card [product]="relatedProduct"></app-product-card>
              }
            </div>
          </div>
        }
      </div>
    } @else {
      <div class="not-found">
        <div class="not-found-icon">üòï</div>
        <h2>Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m</h2>
        <p>S·∫£n ph·∫©m b·∫°n ƒëang t√¨m ki·∫øm kh√¥ng t·ªìn t·∫°i ho·∫∑c ƒë√£ b·ªã x√≥a.</p>
        <button class="btn btn-primary" routerLink="/products">
          üéµ Quay l·∫°i trang s·∫£n ph·∫©m
        </button>
      </div>
    }
  </div>
</div>