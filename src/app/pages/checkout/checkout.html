<div class="checkout-page">
  <div class="container">
    <div *ngIf="!isLoading && cartItems.length > 0" class="checkout-content">
      <div class="checkout-layout">

        <div class="checkout-form-section">
          <div class="form-section">
            <h2>üë§ Th√¥ng tin kh√°ch h√†ng</h2>
            <div class="form-grid">
              <div class="form-group"><label>H·ªç v√† t√™n *</label><input type="text" [(ngModel)]="customerInfo.fullName" name="fullName" class="form-input" required></div>
              <div class="form-group"><label>Email *</label><input type="email" [(ngModel)]="customerInfo.email" name="email" class="form-input" required></div>
              <div class="form-group"><label>S·ªë ƒëi·ªán tho·∫°i *</label><input type="tel" [(ngModel)]="customerInfo.phone" name="phone" class="form-input" required></div>
              <div class="form-group"><label>ƒê·ªãa ch·ªâ *</label><input type="text" [(ngModel)]="customerInfo.address" name="address" class="form-input" required></div>
              <div class="form-group"><label>T·ªânh/Th√†nh ph·ªë *</label><input type="text" [(ngModel)]="customerInfo.city" name="city" class="form-input" required></div>
              <div class="form-group"><label>Qu·∫≠n/Huy·ªán *</label><input type="text" [(ngModel)]="customerInfo.district" name="district" class="form-input" required></div>
              <div class="form-group full-width"><label>Ghi ch√∫</label><textarea [(ngModel)]="customerInfo.note" name="note" class="form-input" rows="3"></textarea></div>
            </div>
          </div>

          <div class="form-section">
            <h2>üí≥ Thanh to√°n</h2>
            <div class="payment-methods">
              <label class="payment-method" [class.active]="paymentMethod === 'COD'">
                <input type="radio" name="payment" value="COD" [(ngModel)]="paymentMethod" hidden>
                <div class="payment-content"><div class="payment-icon">üí∞</div><div class="payment-info"><div class="payment-title">COD (Ti·ªÅn m·∫∑t)</div><div class="payment-desc">Thanh to√°n khi nh·∫≠n h√†ng</div></div></div>
              </label>
              <label class="payment-method" [class.active]="paymentMethod === 'BANK_TRANSFER'">
                <input type="radio" name="payment" value="BANK_TRANSFER" [(ngModel)]="paymentMethod" hidden>
                <div class="payment-content"><div class="payment-icon">üè¶</div><div class="payment-info"><div class="payment-title">Chuy·ªÉn kho·∫£n</div><div class="payment-desc">Qua VietQR/Ng√¢n h√†ng</div></div></div>
                @if (paymentMethod === 'BANK_TRANSFER') {
                  <div class="qr-code-section">
                    <p>Qu√©t m√£ ƒë·ªÉ thanh to√°n:</p>
                    <img src="images/qrthanh.jpg" alt="QR Code" class="qr-image">
                    <div class="bank-details"><strong>BIDV</strong> - 3300576940<br>NGUYEN TIEN THANH</div>
                  </div>
                }
              </label>
            </div>
          </div>
        </div>

        <div class="order-summary-section">
          <div class="summary-card">
            <h3>üì¶ ƒê∆°n h√†ng ({{ cartItems.length }})</h3>

            <div class="order-items-container">
              @for (item of cartItems; track trackByFn($index, item)) {
                <div class="order-item">
                  <div class="item-image-wrapper">
                    <img [src]="getFullImageUrl(item.image)" [alt]="item.productName" class="item-img">
                    <span class="item-qty-badge">{{ item.quantity }}</span>
                  </div>

                  <div class="item-details">
                    <div class="item-header">
                        <span class="item-name" title="{{ item.productName }}">{{ item.productName }}</span>
                        <span class="item-price">{{ item.price | number }}‚Ç´</span>
                    </div>

                    <div class="item-actions">
                       <div class="qty-control">
                          <button (click)="updateQuantityInCheckout(item, item.quantity - 1)" [disabled]="item.quantity <= 1">‚àí</button>
                          <span class="qty-val">{{ item.quantity }}</span>
                          <button (click)="updateQuantityInCheckout(item, item.quantity + 1)">+</button>
                       </div>
                       <button class="delete-btn" (click)="removeItemFromCheckout(item)">X√≥a</button>
                    </div>
                  </div>
                </div>
              }
            </div>

            <div class="order-totals">
              <div class="row"><span>T·∫°m t√≠nh</span><span>{{ total | number }}‚Ç´</span></div>
              <div class="row"><span>V·∫≠n chuy·ªÉn</span><span>Mi·ªÖn ph√≠</span></div>
              <div class="divider"></div>
              <div class="row total"><strong>T·ªïng c·ªông</strong><strong class="highlight">{{ grandTotal | number }}‚Ç´</strong></div>
            </div>

            <button class="btn-place-order" (click)="placeOrder()" [disabled]="isLoading">
              <span *ngIf="!isLoading">ƒê·∫∂T H√ÄNG</span>
              <span *ngIf="isLoading" class="loader"></span>
            </button>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>
