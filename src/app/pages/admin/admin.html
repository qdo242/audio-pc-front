<div class="admin-page">
  <div class="container">
    <div class="admin-header">
      <h1 class="page-title">Qu·∫£n L√Ω Atheng Audio</h1>
      <div class="admin-actions">
        @if (activeTab === 'products') {
          <button class="btn btn-secondary" (click)="addProduct()">
            + Th√™m S·∫£n Ph·∫©m
          </button>
        }
        <button class="btn btn-secondary" routerLink="/">
          ‚Üê V·ªÅ Trang Ch·ªß
        </button>
      </div>
    </div>

    <div class="admin-stats">
      <div class="stat-card">
        <div class="stat-icon">üì¶</div>
        <div class="stat-info">
          <div class="stat-number">{{ stats.totalProducts | number }}</div>
          <div class="stat-label">T·ªïng S·∫£n Ph·∫©m</div>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">üõí</div>
        <div class="stat-info">
          <div class="stat-number">{{ stats.totalOrders | number }}</div>
          <div class="stat-label">ƒê∆°n H√†ng</div>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">üí∞</div>
        <div class="stat-info">
          <div class="stat-number">{{ stats.totalRevenue | number }}‚Ç´</div>
          <div class="stat-label">Doanh Thu</div>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">‚ö†Ô∏è</div>
        <div class="stat-info">
          <div class="stat-number">{{ stats.outOfStock | number }}</div>
          <div class="stat-label">H·∫øt H√†ng</div>
        </div>
      </div>
    </div>

    <div class="admin-tabs">
      <div class="tab-headers">
        <button 
          class="tab-header" 
          [class.active]="activeTab === 'products'"
          (click)="setActiveTab('products')"
        >
          üì¶ Qu·∫£n L√Ω S·∫£n Ph·∫©m
        </button>
        <button 
          class="tab-header" 
          [class.active]="activeTab === 'orders'"
          (click)="setActiveTab('orders')"
        >
          üõí Qu·∫£n L√Ω ƒê∆°n H√†ng
        </button>
      </div>

      <div class="tab-content">
        @if (activeTab === 'products') {
          <div class="tab-pane">
            <div class="products-table">
              <div class="table-header">
                <h3>Danh S√°ch S·∫£n Ph·∫©m ({{ products.length }})</h3>
              </div>
              
              <div class="table-content">
                <div class="table-row header-row">
                  <div class="col col-image">H√¨nh ·∫¢nh</div>
                  <div class="col col-name">T√™n S·∫£n Ph·∫©m</div>
                  <div class="col col-price">Gi√°</div>
                  <div class="col col-category">Danh M·ª•c</div>
                  <div class="col col-stock">T√¨nh Tr·∫°ng</div>
                  <div class="col col-actions">Thao T√°c</div>
                </div>

                @for (product of products; track product.id) {
                  <div class="table-row">
                    <div class="col col-image">
                      <img [src]="product.image || 'assets/images/default-product.png'" [alt]="product.name" class="product-thumb">
                    </div>
                    <div class="col col-name">
                      <div class="product-name">{{ product.name }}</div>
                      <div class="product-brand">{{ product.brand }}</div>
                    </div>
                    <div class="col col-price">
                      <div class="current-price">{{ product.price | number }}‚Ç´</div>
                      @if (product.originalPrice) {
                        <div class="original-price">{{ product.originalPrice | number }}‚Ç´</div>
                      }
                    </div>
                    <div class="col col-category">
                      <span class="category-badge">{{ product.category }}</span>
                    </div>
                    <div class="col col-stock">
                      @if (product.stock > 0) {
                        <span class="status-badge in-stock">C√≤n H√†ng ({{product.stock}})</span>
                      } @else {
                        <span class="status-badge out-of-stock">H·∫øt H√†ng</span>
                      }
                    </div>
                    <div class="col col-actions">
                      <button class="btn-edit" (click)="editProduct(product)">
                        ‚úèÔ∏è S·ª≠a
                      </button>
                      <button class="btn-delete" (click)="deleteProduct(product.id)">
                        üóëÔ∏è X√≥a
                      </button>
                    </div>
                  </div>
                }
              </div>
            </div>
          </div>
        }

        @if (activeTab === 'orders') {
          <div class="tab-pane">
            <div class="orders-table">
              <div class="table-header">
                <h3>Danh S√°ch ƒê∆°n H√†ng ({{ orders.length }})</h3>
              </div>
              
              <div class="table-content">
                <div class="table-row header-row">
                  <div class="col col-id">M√£ ƒêH</div>
                  <div class="col col-customer">Kh√°ch H√†ng</div>
                  <div class="col col-items">S·∫£n Ph·∫©m</div>
                  <div class="col col-total">T·ªïng Ti·ªÅn</div>
                  <div class="col col-status">Tr·∫°ng Th√°i</div>
                  <div class="col col-date">Ng√†y ƒê·∫∑t</div>
                  <div class="col col-actions">Thao T√°c</div>
                </div>

                @for (order of orders; track order.id) {
                  <div class="table-row">
                    <div class="col col-id">
                      #{{ order.id }}
                    </div>
                    <div class="col col-customer">
                      <div class="customer-name">{{ order.shippingAddress.fullName }}</div>
                      <div class="customer-phone">{{ order.shippingAddress.phone }}</div>
                    </div>
                    <div class="col col-items">
                      <div class="items-count">{{ order.items.length }} s·∫£n ph·∫©m</div>
                      <div class="items-preview">
                        @for (item of order.items.slice(0, 2); track item.productId) {
                          <span class="item-name">{{ item.productName }}</span>
                        }
                        @if (order.items.length > 2) {
                          <span class="more-items">+{{ order.items.length - 2 }} s·∫£n ph·∫©m kh√°c</span>
                        }
                      </div>
                    </div>
                    <div class="col col-total">
                      {{ order.totalAmount | number }}‚Ç´
                    </div>
                    <div class="col col-status">
                      <select 
                            [value]="order.status" 
                            (change)="updateOrderStatus(order.id, $event)"
                            class="status-select"
                            [style.background]="getStatusColor(order.status)"
                        >
                        <option value="PENDING">Ch·ªù x·ª≠ l√Ω</option>
                        <option value="CONFIRMED">ƒê√£ x√°c nh·∫≠n</option>
                        <option value="PROCESSING">ƒêang x·ª≠ l√Ω</option>
                        <option value="SHIPPED">ƒê√£ giao h√†ng</option>
                        <option value="DELIVERED">ƒê√£ nh·∫≠n</option>
                        <option value="CANCELLED">ƒê√£ h·ªßy</option>
                      </select>
                    </div>
                    <div class="col col-date">
                      {{ order.createdAt | date:'dd/MM/yyyy' }}
                    </div>
                    <div class="col col-actions">
                      <button class="btn-view" (click)="viewOrder(order.id)">
                        üëÅÔ∏è Xem
                      </button>
                    </div>
                  </div>
                }

                @if (orders.length === 0) {
                  <div class="empty-state">
                    <div class="empty-icon">üõí</div>
                    <h3>Ch∆∞a c√≥ ƒë∆°n h√†ng n√†o</h3>
                    <p>C√°c ƒë∆°n h√†ng s·∫Ω xu·∫•t hi·ªán ·ªü ƒë√¢y khi kh√°ch h√†ng ƒë·∫∑t h√†ng</p>
                  </div>
                }
              </div>
            </div>
          </div>
        }
      </div> </div> @if (showProductForm) {
      <div class="modal-overlay" [class.uploading]="isUploading">
        @if (isUploading) {
          <div class="upload-spinner">
            <div class="spinner-icon"></div>
            <span>ƒêang t·∫£i ·∫£nh l√™n...</span>
          </div>
        }
        <div class="modal-content">
          <div class="modal-header">
            <h2>{{ editingProduct ? 'S·ª≠a S·∫£n Ph·∫©m' : 'Th√™m S·∫£n Ph·∫©m M·ªõi' }}</h2>
            <button class="modal-close" (click)="showProductForm = false">√ó</button>
          </div>

          <div class="modal-body">
            <form (ngSubmit)="saveProduct()" class="product-form">
              <div class="form-grid">
                
                <div class="form-group">
                  <label class="form-label">T√™n S·∫£n Ph·∫©m *</label>
                  <input type="text" [(ngModel)]="productForm.name" name="name" class="form-input" required>
                </div>
                <div class="form-group">
                  <label class="form-label">Gi√° Hi·ªán T·∫°i *</label>
                  <input type="number" [(ngModel)]="productForm.price" name="price" class="form-input" required>
                </div>
                <div class="form-group">
                  <label class="form-label">Gi√° G·ªëc</label>
                  <input type="number" [(ngModel)]="productForm.originalPrice" name="originalPrice" class="form-input">
                </div>
                <div class="form-group">
                  <label class="form-label">Danh M·ª•c</label>
                  <select [(ngModel)]="productForm.category" name="category" class="form-input">
                    <option value="headphone">Tai Nghe</option>
                    <option value="speaker">Loa</option>
                    <option value="accessory">Ph·ª• ki·ªán</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label">Th∆∞∆°ng Hi·ªáu</label>
                  <input type="text" [(ngModel)]="productForm.brand" name="brand" class="form-input">
                </div>
                <div class="form-group">
                  <label class="form-label">T·ªìn kho</label>
                  <input type="number" [(ngModel)]="productForm.stock" name="stock" class="form-input">
                </div>

                <div class="form-group full-width">
                  <label class="form-label">M√¥ T·∫£</label>
                  <textarea [(ngModel)]="productForm.description" name="description" class="form-input" rows="3"></textarea>
                </div>

               <!-- <div class="form-group full-width">
                  <label class="form-label">·∫¢nh Ch√≠nh (·∫¢nh b√¨a)</label>
                  <input type="file" (change)="onFileSelected($event, 'image')" class="form-input file-input" [disabled]="isUploading">
                  @if (productForm.image) {
                    <div class="image-preview">
                      <input type="text" [value]="productForm.image" readonly class="form-input url-preview" (click)="$event.target.select()">
                      <img [src]="productForm.image" alt="Preview">
                    </div>
                  }
                </div>-->

                <div class="form-group full-width">
                  <label class="form-label">·∫¢nh S·∫£n Ph·∫©m</label>
                  <div class="features-list">
                    @for (image of productForm.images || []; track $index) {
                      <div class="feature-input-group">
                        <input type="file" (change)="onFileSelected($event, 'images', $index)" class="form-input file-input" [disabled]="isUploading">
                        @if (productForm.images?.[$index]) {
                           <div class="image-preview-small">
                             <input type="text" [value]="productForm.images?.[$index]" readonly class="form-input url-preview small" (click)="$event.target.select()">
                             <img [src]="productForm.images?.[$index]" alt="Preview">
                           </div>
                        }
                        <button
                          type="button"
                          class="remove-feature-btn"
                          (click)="removeImageField($index)"
                          [disabled]="isUploading"
                        >
                          √ó
                        </button>
                      </div>
                    }
                    <button type="button" class="add-feature-btn" (click)="addImageField()" [disabled]="isUploading">
                      + Th√™m ·∫¢nh
                    </button>
                  </div>
                </div>

                <div class="form-group">
                  <label class="checkbox-label">
                    <input type="checkbox" [(ngModel)]="productForm.isActive" name="isActive">
                    <span class="checkmark"></span>
                    Hi·ªÉn th·ªã (Active)
                  </label>
                </div>
                <div class="form-group">
                  <label class="checkbox-label">
                    <input type="checkbox" [(ngModel)]="productForm.isFeatured" name="isFeatured">
                    <span class="checkmark"></span>
                    N·ªïi b·∫≠t (Featured)
                  </label>
                </div>
              
              </div> <div class="form-actions">
                <button type="button" class="btn btn-secondary" (click)="cancelEdit()">
                  H·ªßy
                </button>
                <button type="submit" class="btn btn-primary" [disabled]="isUploading">
                  {{ isUploading ? 'ƒêang t·∫£i ·∫£nh...' : (editingProduct ? 'C·∫≠p Nh·∫≠t' : 'Th√™m S·∫£n Ph·∫©m') }}
                </button>
              </div>
            </form>
          </div> </div> </div> }
    
  </div> </div> 